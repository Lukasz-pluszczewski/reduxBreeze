{"version":3,"file":"reduxBreeze.js","sources":["../src/tools.js","../src/defaultPlugin.js","../src/index.js"],"sourcesContent":["import _ from 'lodash';\n\n/**\n * Helper for redux to attach reducers to one field instead of composing them into separate fields\n * @param {array} rawReducers array of unchained, not combined reducers\n * @return {function} reducer\n */\nexport const chainReducers = rawReducers => (state, action) => {\n  const reducers = _.filter(rawReducers, reducer => {\n    if (_.isNil(reducer)) {\n      return false;\n    }\n    if (_.isFunction(reducer)) {\n      return true;\n    }\n    throw new Error('reducers passed to chain reducers must be either a valida reducer (function) or nil (null or undefined)');\n  });\n  return reducers.reduce((accuState, reducer) => reducer(accuState, action), state);\n};\n\n/**\n * Checks if there are conflicts in plugins in given adapterType (conflict = two plugins handling same actionType)\n * @param {array} plugins list of plugins\n * @param {string} adapterType name of the adapter type: 'actionAdapter', 'reducerAdapter', 'initialStateAdapter'\n * @param {function(actionType: string, pluginName: string, adapterType: string)} map function that changes actionTypes to a new values\n * @return {string} error text or empty string if no conflicts found\n */\nexport const checkConflicts = (plugins, adapterType, map = actionType => actionType) => {\n  // TODO add checking for plugins having the same name\n  const foundAdapters = {};\n  plugins.forEach(plugin => {\n    if (plugin[adapterType]) {\n      _.forEach(plugin[adapterType], (adapter, actionType) => {\n        const mappedActionType = map(actionType, plugin.name, adapterType);\n        if (!foundAdapters[mappedActionType]) {\n          foundAdapters[mappedActionType] = [];\n        }\n        foundAdapters[mappedActionType].push(plugin.name);\n      });\n    }\n  });\n  return _(foundAdapters)\n    .map((listOfPlugins, actionType) => listOfPlugins.length > 1 ? `${adapterType} '${actionType}' is defined in plugins: ${listOfPlugins.join(',')}` : null)\n    .filter()\n    .join('; ');\n};\n\n/**\n * Function to merge different plugins into one plugin object\n * @param {array} plugins array of plugins objects\n * @param {boolean} strict with strict turned on we throw an error on plugin conflicts\n * @param {function} mapActionTypes function that changes names of action types\n * @return {{actionAdapter, reducerAdapter, initialStateAdapter}} merged plugin object\n */\nexport const mergePlugins = (plugins, { strict = true, mapActionTypes = actionType => actionType } = {}) => {\n  const actionAdapterConflicts = checkConflicts(plugins, 'actionAdapter', mapActionTypes);\n  const reducerAdapterConflicts = checkConflicts(plugins, 'reducerAdapter', mapActionTypes);\n  const initialStateAdapterConflicts = checkConflicts(plugins, 'initialStateAdapter', mapActionTypes);\n  const conflicts = [];\n  const conflictsVerbose = [];\n  if (actionAdapterConflicts) {\n    conflicts.push('actionAdapters');\n    conflictsVerbose.push(actionAdapterConflicts);\n  }\n  if (reducerAdapterConflicts) {\n    conflicts.push('reducerAdapters');\n    conflictsVerbose.push(reducerAdapterConflicts);\n  }\n  if (initialStateAdapterConflicts) {\n    conflicts.push('initialStateAdapters');\n    conflictsVerbose.push(initialStateAdapterConflicts);\n  }\n\n  if (conflicts.length) {\n    const errorMessage = `Conflicts in adapters: ${conflicts.join(', ')}. ${conflictsVerbose.join('. ')}.`;\n    if (strict) {\n      throw new Error(errorMessage);\n    }\n    console.warn(`${errorMessage} Duplicated adapters will be overwritten!`);\n  }\n\n  return {\n    actionAdapter: plugins.reduce((actionAdapter, plugin) => ({\n      ...actionAdapter,\n      ..._.reduce(plugin.actionAdapter, (accu, actionAdapter, actionType) => {\n        accu[mapActionTypes(actionType, plugin.name, 'actionAdapter')] = actionAdapter;\n        return accu;\n      }, {}),\n    }), {}),\n    reducerAdapter: plugins.reduce((actionAdapter, plugin) => ({\n      ...actionAdapter,\n      ..._.reduce(plugin.reducerAdapter, (accu, reducerAdapter, actionType) => {\n        accu[mapActionTypes(actionType, plugin.name, 'reducerAdapter')] = reducerAdapter;\n        return accu;\n      }, {}),\n    }), {}),\n    initialStateAdapter: plugins.reduce((actionAdapter, plugin) => ({\n      ...actionAdapter,\n      ..._.reduce(plugin.initialStateAdapter, (accu, initialStateAdapter, actionType) => {\n        accu[mapActionTypes(actionType, plugin.name, 'initialStateAdapter')] = initialStateAdapter;\n        return accu;\n      }, {}),\n    }), {}),\n\n  };\n};\n\n/**\n *\n * @param {string} actionName camelCase name of the action (e.g. someAction)\n * @param {string} suffix string that is going to be added at the end of the created action type\n * @param {string} prefix string that is going to be added at the beginning of the created action type\n * @return {string} upperSnakeCase action type (e.g. SOME_ACTION or with example suffix SOME_ACTION_SUFFIX)\n */\nexport const createActionType = (actionName, suffix = '', prefix = '') => {\n  const upperSnakeCase = _.snakeCase(actionName).toUpperCase();\n  return `${prefix ? `${prefix.toUpperCase()}_` : ''}${upperSnakeCase}${suffix ? `_${suffix.toUpperCase()}` : ''}`;\n};\n\n/**\n * Works like lodash _.set() but does not mutate object (doesn't work with array style keys like `someArray[2].anotherField`)\n * @param {object} object source object\n * @param {string|object} path in object to set value in or object with paths as keys and values as values (if path is an object it ignores 'value')\n * @param {any} value to set in given path\n * @param {string} delimiter path delimiter; by default: '.'\n * @return {object} new object with value(s) changed\n */\nexport const immutableSet = (object, path, value = null, delimiter = '.') => {\n  // console.log('immutableSet', {object, path, value, delimiter});\n  if (!path) {\n    return value;\n  }\n  if (_.isPlainObject(path)) {\n    if (_.isEmpty(path)) {\n      return object;\n    }\n    return _.reduce(path, (accu, value, path) => immutableSet(accu, path, value, delimiter), object);\n  }\n\n  const pathSplit = path.split(delimiter);\n  if (pathSplit.length === 1) {\n    return {\n      ...object,\n      [path]: value,\n    };\n  }\n  let childObject = {};\n  if (_.has(object, pathSplit[0])) {\n    childObject = object[pathSplit[0]];\n    if (!_.isPlainObject(childObject)) {\n      throw new Error(`Part of 'path' provided is defined in 'object' and is not a plain JS object but ${typeof childObject}. It's most likely an error. Check the path and object provided to immutableSet function`);\n    }\n  }\n  return {\n    ...object,\n    [pathSplit[0]]: immutableSet(childObject, _.tail(pathSplit).join(delimiter), value, delimiter),\n  };\n};\n\n/**\n * Copy value from fromPath in fromObject and create new object from toObject with that value saved in toPath\n * @param {object} fromObject object which you get the value from\n * @param {string} fromPath path in fromObject where you get tha value from\n * @param {object} toObject object where you save the value to\n * @param {string} toPath path in toObject where you save the value\n * @return {object} new object created from values in toObject\n */\nexport const immutablyCopyValue = (\n  fromObject,\n  fromPath,\n  toObject,\n  toPath\n) => immutableSet(toObject, toPath, _.get(fromObject, fromPath));\n","import _ from 'lodash';\n\nclass hasNotBeenDefined {}\n\nconst createDefaultPlugin = ({ createActionType, immutableSet }, config) => ({\n  /**\n   * Object of functions that gets `actionDefinition` and `actionName` as arguments and return action creator\n   */\n  actionAdapter: {\n    default(actionDefinition, actionName) {\n      return params => ({\n        type: createActionType(actionName),\n        payload: params,\n      });\n    },\n  },\n\n  /**\n   * Object of functions that gets `actionDefinition`, `actionName`, and `initialState` and returns a reducer\n   */\n  reducerAdapter: {\n    default(actionDefinition, actionName, initialState) {\n      return (state = initialState, action) => {\n        if (action.type === createActionType(actionName)) {\n          let resultsAssignments;\n\n          // result is array of assignments\n          if (Array.isArray(actionDefinition.result)) {\n            resultsAssignments = actionDefinition.result.reduce(\n              (\n                accu,\n                {\n                  sourcePath,\n                  targetPath,\n                  defaultValue = new hasNotBeenDefined(),\n                  value = new hasNotBeenDefined(),\n                }\n              ) => {\n                // setting default value if one has not been provided and defaultValue is defined\n                if (\n                  !(defaultValue instanceof hasNotBeenDefined)\n                  && _.isUndefined(_.get(action, sourcePath))\n                  && value instanceof hasNotBeenDefined\n                ) {\n                  accu[targetPath] = _.isFunction(defaultValue) ? defaultValue(action) : defaultValue;\n\n                // setting value based on sourcePath\n                } else if (value instanceof hasNotBeenDefined) {\n                  accu[targetPath] = _.get(action, _.isFunction(sourcePath) ? sourcePath(action) : sourcePath);\n\n                // setting value calculated by a 'value' function\n                } else if (_.isFunction(value)) {\n                  accu[targetPath] = value(action, _.get(state, targetPath));\n\n                // setting hardcoded value from 'value' field in the definition\n                } else {\n                  accu[targetPath] = value;\n                }\n                return accu;\n              },\n              {}\n            );\n\n          // result is a string ('list', 'entity') or is not provided\n          } else {\n            const resultName = actionDefinition.resultName || actionName;\n\n            // setting default value if one has not been provided and defaultValue is defined\n            if (\n              _.has(actionDefinition, 'defaultValue')\n              && _.isUndefined(action.payload)\n              && _.has()\n            ) {\n              resultsAssignments = { [resultName]: actionDefinition.defaultValue };\n            } else if (!_.has(actionDefinition, 'value')) {\n              resultsAssignments = { [resultName]: action.payload };\n\n            // setting value calculated by a 'value' function\n            } else if (_.isFunction(actionDefinition.value)) {\n              resultsAssignments = { [resultName]: actionDefinition.value(action, state[resultName]) };\n\n            // setting hardcoded value from 'value' field in the definition\n            } else {\n              resultsAssignments = { [resultName]: actionDefinition.value };\n            }\n          }\n          return immutableSet(state, resultsAssignments);\n        }\n        return state;\n      };\n    },\n  },\n\n  /**\n   * Object of functions that gets `actionDefinition` and `actionName` as arguments and return assignment object (with keys = paths, values = values to be saved in those paths)\n   */\n  initialStateAdapter: {\n    default(actionDefinition, actionName) {\n      let resultsAssignements = null;\n      let defaultValue;\n      if (_.has(actionDefinition, 'initialValue')) {\n        defaultValue = actionDefinition.initialValue;\n      } else if (actionDefinition.result === 'list') {\n        defaultValue = [];\n      } else if (actionDefinition.result === 'entity') {\n        defaultValue = null;\n      }\n\n      if (Array.isArray(actionDefinition.result)) {\n        resultsAssignements = actionDefinition.result.reduce(\n          (accu, { targetPath, result, initialValue = new hasNotBeenDefined() }) => {\n            if (initialValue instanceof hasNotBeenDefined) {\n              accu[targetPath] = result === 'list' ? [] : null;\n            } else {\n              accu[targetPath] = initialValue;\n            }\n            return accu;\n          },\n          {}\n        );\n      } else {\n        resultsAssignements = { [actionDefinition.resultName]: defaultValue };\n      }\n      return resultsAssignements;\n    },\n  },\n});\n\nexport default createDefaultPlugin;\n","import _ from 'lodash';\nimport { combineReducers } from 'redux';\nimport {\n  immutableSet,\n  createActionType,\n  chainReducers,\n  mergePlugins,\n  checkConflicts,\n  immutablyCopyValue,\n} from './tools';\nimport createDefaultPlugin from './defaultPlugin';\n\nconst defaultConfig = {\n  useDefaultPlugin: true,\n  strict: true,\n  /**\n   *\n   * @param {string} actionType action type name (like 'default' in default plugin)\n   * @param {string} pluginName name of the plugin\n   * @param {string} adapterType type of adapter: 'actionAdapter', 'reducerAdapter', 'initialStateAdapter'\n   * @return {string} changed actionType\n   */\n  mapActionTypes(actionType, pluginName, adapterType) {\n    return actionType;\n  },\n};\n\nexport const tools = {\n  immutableSet,\n  createActionType,\n  chainReducers,\n  mergePlugins,\n  checkConflicts,\n  immutablyCopyValue,\n};\n\nconst createReduxBreezeInstance = (actionDefinitions, userConfig = defaultConfig, ...plugins) => {\n  const config = {\n    ...defaultConfig,\n    ...userConfig,\n  };\n\n  // merging plugins deeply\n  const pluginsToMerge = config.useDefaultPlugin\n    ? [createDefaultPlugin(tools), ...plugins.map(plugin => plugin(tools, config))]\n    : plugins.map(plugin => plugin(tools));\n\n  const plugin = mergePlugins(\n    pluginsToMerge,\n    {\n      strict: config.strict,\n      mapActionTypes: config.mapActionTypes,\n    }\n  );\n\n  /**\n   * Function to generate initialState (and immutably deeply merge it with custom initialState) from actions definitions\n   * @param {object} actions object of action definitions\n   * @param {object} initialState optional custom initial state\n   * @return {object} created initial state (merged with provided initialState)\n   */\n  const createInitialState = (actions, initialState = {}) => _.reduce(\n    actions,\n    (actionsState, actionDefinition, actionName) => {\n      if (plugin.initialStateAdapter[actionDefinition.type]) {\n        return immutableSet(\n          actionsState,\n          plugin.initialStateAdapter[actionDefinition.type](actionDefinition, actionName)\n        );\n      }\n      return actionsState;\n    },\n    initialState\n  );\n\n  return {\n    combineReducers(customReducers = {}) {\n      const reducers = _.reduce(actionDefinitions, (reducers, actions, reducerName) => {\n        // getting final initial state for this combined/chained reducer (triggering custom reducers to get their initial state)\n        const initialState = createInitialState(\n          actions,\n          reducers[reducerName] ? reducers[reducerName](undefined, {}) : {} // eslint-disable-line  no-undefined\n        );\n\n        // creating array of reducers tha are going to be chained on the `reducerName` field\n        const reducersToChain = _.map(actions, (actionDefinition, actionName) => {\n          if (plugin.reducerAdapter[actionDefinition.type]) {\n            return plugin.reducerAdapter[actionDefinition.type](actionDefinition, actionName, initialState);\n          }\n          throw new Error(`Unknown type '${actionDefinition.type}' of action '${actionName}'. It's most likely because you did not install plugin to handle reducer for this type of actions`);\n        });\n\n        // adding custom reducer (if one has been provided) at the end of the chain for the user to be able to modify default behaviour\n        if (reducers[reducerName]) {\n          reducersToChain.push(reducers[reducerName]);\n        }\n\n        reducers[reducerName] = chainReducers(reducersToChain);\n        return reducers;\n      }, customReducers);\n      return combineReducers(reducers);\n    },\n    getAction(actionName, config) {\n      const actionGroup = _.find(actionDefinitions, actionsList => _.has(actionsList, actionName));\n      if (!actionGroup) {\n        throw new Error(`${actionName} action has not been found`);\n      }\n      if (!plugin.actionAdapter[actionGroup[actionName].type]) {\n        throw new Error(`Unknown type '${actionGroup[actionName].type}' of '${actionName}' action. It's most likely because you did not install plugin to handle action creation for this type of actions`);\n      }\n      return plugin.actionAdapter[actionGroup[actionName].type](actionGroup[actionName], actionName, config);\n    },\n    getActionDefinitions() {\n      return actionDefinitions;\n    },\n    getMergedPlugin() {\n      return plugin;\n    },\n  };\n};\n\nexport default createReduxBreezeInstance;\n"],"names":["chainReducers","state","action","reducers","_","filter","rawReducers","isNil","reducer","isFunction","Error","reduce","accuState","checkConflicts","plugins","adapterType","map","actionType","foundAdapters","forEach","plugin","adapter","mappedActionType","name","push","listOfPlugins","length","join","mergePlugins","strict","mapActionTypes","actionAdapterConflicts","reducerAdapterConflicts","initialStateAdapterConflicts","conflicts","conflictsVerbose","errorMessage","warn","actionAdapter","accu","reducerAdapter","initialStateAdapter","createActionType","actionName","suffix","prefix","upperSnakeCase","snakeCase","toUpperCase","immutableSet","object","path","value","delimiter","isPlainObject","isEmpty","pathSplit","split","childObject","has","tail","immutablyCopyValue","fromObject","fromPath","toObject","toPath","get","hasNotBeenDefined","createDefaultPlugin","config","actionDefinition","params","initialState","type","resultsAssignments","Array","isArray","result","sourcePath","targetPath","defaultValue","isUndefined","resultName","payload","resultsAssignements","initialValue","defaultConfig","pluginName","tools","createReduxBreezeInstance","actionDefinitions","userConfig","pluginsToMerge","useDefaultPlugin","createInitialState","actions","actionsState","customReducers","reducerName","undefined","reducersToChain","combineReducers","actionGroup","find","actionsList"],"mappings":"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"}